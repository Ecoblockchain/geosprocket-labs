<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <link href="//netdna.bootstrapcdn.com/bootswatch/3.0.3/readable/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/themes/css/cartodb.css" />
    <!--[if lte IE 8]>
      <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/themes/css/cartodb.ie.css" />
    <![endif]-->
    <style>
      #map {
        height: 450px; 
        margin: 0px;
        padding: 0px
        position: absolute;
      }
      .controls {
        margin-top: 16px;
        position: absolute;
        border: 1px solid transparent;
        border-radius: 2px 0 0 2px;
        box-sizing: border-box;
        -moz-box-sizing: border-box;
        height: 52px;
        outline: none;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
      }

      #pac-input {
        background-color: #fff;
        padding: 0 11px 0 13px;
        width: 400px;
        font-family: Roboto;
        font-size: 15px;
        font-weight: 300;
        text-overflow: ellipsis;
      }

      #pac-input:focus {
        border-color: #4d90fe;
        margin-left: -1px;
        padding-left: 14px;  /* Regular padding-left + 1. */
        width: 401px;
      }

      .pac-container {
        /*font-family: Roboto;*/
      }

      #type-selector {
        color: #fff;
        background-color: #4d90fe;
        padding: 5px 11px 0px 11px;
      }

      #type-selector label {
        /*font-family: Roboto;*/
        font-size: 13px;
        font-weight: 300;
      }
}

    </style>
    <title>BTV Redistricting</title>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=places"></script>
    <script src="http://libs.cartocdn.com/cartodb.js/v3/cartodb.uncompressed.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
    <script>
// This example adds a search box to a map, using the Google Place Autocomplete
// feature. People can enter geographical searches. The search box will return a
// pick list containing a mix of places and predicted search terms.

function initialize() {

  var markers = [];
  var map = new google.maps.Map(document.getElementById('map'), {
    mapTypeId: google.maps.MapTypeId.ROADMAP,
    center: new google.maps.LatLng(44.495, -73.21),
    zoom:12,
    maxZoom:16,
    disableDefaultUI: true,
    zoomControl: true,
    zoomControlOptions: {
      style: google.maps.ZoomControlStyle.SMALL
    }
  });

  var layer = cartodb.createLayer(map, {
    user_name: 'geosprocket',
    type: 'cartodb',
    sublayers: [{
       sql: 'select * from btv_redistricting',
       cartocss: "Map{buffer-size:512;}#layer[year=2010]{polygon-opacity:0;line-opacity:0.7;line-width:1.8;line-color: #4a336a;::labels[year=2010]{text-name:'Proposed Ward ' + [ward];text-placement: point;text-face-name: 'DejaVu Sans Book';text-size: 14;text-fill: #000;text-halo-fill: #FFF;text-halo-radius: 2;text-halo-rasterizer:fast;text-dy: -10;text-allow-overlap: false;text-clip:false;text-placement-type: dummy;text-label-position-tolerance: 0;}}"
    }]
  })
  .addTo(map);
          
  var currentCenter = map.getCenter();
  var voterLat = currentCenter.lat();
  var voterLng = currentCenter.lng();

  // Create the search box and link it to the UI element.
  var input = /** @type {HTMLInputElement} */(
      document.getElementById('pac-input'));
  map.controls[google.maps.ControlPosition.TOP_CENTER].push(input);

  var searchBox = new google.maps.places.SearchBox(
    /** @type {HTMLInputElement} */(input));

  // [START region_getplaces]
  // Listen for the event fired when the user selects an item from the
  // pick list. Retrieve the matching places for that item.
  google.maps.event.addListener(searchBox, 'places_changed', function(layer) {
    var places = searchBox.getPlaces();

    for (var i = 0, marker; marker = markers[i]; i++) {
      marker.setMap(null);
    }

    // For each place, get the icon, place name, and location.
    markers = [];
    var bounds = new google.maps.LatLngBounds();
    for (var i = 0, place; place = places[i]; i++) {

      // Create a marker for each place.
      var marker = new google.maps.Marker({
        map: map,
        title: place.name,
        position: place.geometry.location
      });

      markers.push(marker);

      bounds.extend(place.geometry.location);

    }
    map.fitBounds(bounds);
    
    layer.createSubLayer({
      sql: "SELECT * FROM btv_redistricting WHERE ST_Intersects(the_geom, ST_GeometryFromText('POINT(" + voterLng + " " + voterLat + ")', 4326))",
      cartocss: "Map{buffer-size:512;}#layer {::old[year=1990]{polygon-opacity:0;line-opacity:0.7;line-width:2.8;line-color: #444;line-dasharray:6,6;}::new[year=2010]{polygon-opacity:0.5;line-opacity:0.6;line-width:1.2;line-color: #0000ff;polygon-fill:#4a336a;}::labels[year=2010]{text-name:'Proposed Ward ' + [ward];text-placement: point;text-face-name: 'DejaVu Sans Book';text-size: 14;text-fill: #000;text-halo-fill: #FFF;text-halo-radius: 2;text-halo-rasterizer:fast;text-dy: -10;text-allow-overlap: true;text-placement-type: dummy;text-label-position-tolerance: 0;}}"
    });
    
  });
  // [END region_getplaces]

  // Bias the SearchBox results towards places that are within the bounds of the
  // current map's viewport.
  google.maps.event.addListener(map, 'bounds_changed', function() {
    var bounds = map.getBounds();
    searchBox.setBounds(bounds);
  });
}

google.maps.event.addDomListener(window, 'load', initialize);

    </script>
    <style>
      #target {
        width: 345px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>BTV VoteFinder</h1>
      <h4 class="text-muted">Enter your address below to see how the new plan affects you:</h4>
      
      <div class="row">
        <input id="pac-input" class="controls" type="text" placeholder="Search">
        <div id="map"></div>
      </div>

      <div id="results" class="row">
        <h2>Will my ward change?</h2>
        <h2 id="wardchange" class="text-muted">-</h2>
        <h2>What district will I vote in?</h2>
        <h2 id="distchange" class="text-muted">-</h2>
        <h2>What will be my polling place?</h2>
        <h2 id="pollchange" class="text-muted">-</h2>
        <button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">
        What are these changes about?
        </button>
      </div>

      
      <hr>

      <!-- Modal -->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h2 class="modal-title" id="myModalLabel">About Redistricting</h2>
              </div>
              <div class="modal-body">
                <h4 class="text-muted">The Burlington city council is proposing changes to the political layout of Vermont's largest municipality, and on town meeting day we'll be voting whether or not to adopt them. These changes are meant to fix current imbalances in the principal of "One person, One Vote". <br><br>
                Under the proposed plan, the city will be structured into smaller <a class="text-success">wards</a> (about 5,000 people) and larger <a class="text-success">districts</a> (about 10,000 people in 2 wards). Each voter will select one ward councilor and one district councilor, for a total of 12 council members.<br><br>Use this app to find out what the proposed plan means for you: which ward and district you belong to, and where your polling place is located. You can learn more about the redistricting process <a href="http://www.burlingtonvt.gov/CityCouncil/Ward-Redistricting/" target="_blank">on the city's web page</a></h4>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              </div>
            </div><!-- /.modal-content -->
          </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->


    </div>
  </body>
</html>